<!DOCTYPE html>
<html>
  <head>

    <!-- <link href="/static/css/bootstrap.min.css" rel="stylesheet"> -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="/static/scripts/utils.js"></script>
    <script type="text/javascript">

      $(document).ready(function() {

        // show file value after file select 
        $("#ifile").on('change',function(){
            file = document.getElementById("ifile").files[0];
            $("#ifile-label").html( file.name ); 
        })

        // pushing the "predict" button
        $("#predict").click(function(e) {

          // create a random name for the temp dir
          var temp_dir = randomDir()
          console.log(temp_dir)
          
          // clear GUI
          $("#data-body").text('processing... please wait');
          $("#newtable").html('');
          
          // make sure the browser can upload XMLHTTP requests
          if (!window.XMLHttpRequest) {
            $("#data-body").text("this browser does not support file upload");
            return;
          }

          // upload file to server
          var file = document.getElementById("ifile").files[0];

          if (upload(file, temp_dir)==false) {
            $("#data-body").text("upload timed out, aborted...");
            return;
          }

          var version = $("#version option:selected").text();
          if (version=='dev') {
            version = '0';
          }

          console.log(version)

          // send job
          $.post("/predict", {"ifile"   : file.name,
                              "model"   : $("#myselect option:selected").text(),
                              "version" : version,
                              "temp_dir": temp_dir
                              })

          // show results
          .done(function(results) {
            $("#data-body").text(results);
            
            //console.log(results)
      
            var myjson = JSON.parse(results);

            var tbl_body = '<thead><tr><th>#mol</th><th>prediction</th></tr></thead>';
            $.each(myjson, function() {
              var tbl_row = "";
              //console.log(this)
              $.each(this, function(k , v) {
                //console.log(k,v)
                tbl_body += "<tr><td>"+(k+1)+"</td><td>"+v+"</td></tr>"; 
              })          
            })
            $("#newtable").html(tbl_body);            
        });
        e.preventDefault();
      });
    });
    </script>
  </head>

  <body>
    <div class="container-fluid" >
      <div class="row">  
          <div class="col-8">
            <h2 >Flame predict interface</h2>
          </div>
          
          <div class="col-4">
            <img class="pull-left pull-top" src="/static/images/etransafe-logo.png"></image>
          </div>

          <div>&nbsp;</div>
      </div>  

        <div class="row">
          <div class ="col-8">

            <form class="form">

              <div class="form-group row">
                <label class="col-sm-2 control-label" for="ifile">Input </label>
                <div class="col-sm-10">                  
                  <div class="custom-file" id="customFile">
                    <input type="file" class="custom-file-input" id="ifile">
                    <label class="custom-file-label" for="ifile" id="ifile-label">Choose file</label>
                  </div>
                </div>
              </div>

              <div class="form-group row">
                <label class="col-sm-2 control-label" for="model">model</label>
                <div class="col-sm-10">
                  <select class="form-control" id="myselect" name="model">
                      {% for m in model_list %}
                      <option name="model-{{ m }}">{{m}}</option>
                      {% endfor %}
                  </select>
                </div>
              </div>
              
              <div class="form-group row">
                <label class="col-sm-2 control-label" for="version">version</label>
                <div class="col-sm-10">
                  <select class="form-control" id="version" name="version">
                      <option >dev</option>
                      <option >1</option>
                      <option >2</option>
                      <option >3</option>
                      <option >4</option>
                      <option >5</option>
                  </select>               
                </div>
              </div>
              
            </form>
            
          </div>
          
          <div class="col-4 ">
            <button class="btn btn-outline-primary" role="button" id="predict">Predict</button>
          </div>

      </div>

      <div class="row">

        <div class="col-12">
          <h3>Results</h3>
          <table class= "table table-bordered table-striped" id="newtable"></table>
        </div>
        
        <div class="col-12">
          <h3>Console</h3>
          <pre id="data-body">[not run]</pre>
        </div>

      </div>

  </body>
</html>