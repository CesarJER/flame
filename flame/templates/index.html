<!DOCTYPE html>
<html>
  <head>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="/static/scripts/utils.js"></script>
    <script type="text/javascript">

      $(document).ready(function() {
          $("#predict").click(function(e) {

            // create a random name for the temp dir
            let temp_dir = randomDir()
            console.log(temp_dir)
            
            // clear GUI
            $("#data-body").text('processing... please wait');
            $("#newtable").html('');
            
            // make sure the browser can upload XMLHTTP requests
            if (!window.XMLHttpRequest) {
              $("#data-body").text("this browser does not support file upload");
              return;
            }

            // upload file to server
            let file = document.getElementById("ifile").files[0];

            if (upload(file, temp_dir)==false) {
              $("#data-body").text("upload timed out, aborted...");
              return;
            }

            // send job
            $.post("/predict", {"ifile"   : file.name,
                                "model"   : $("#myselect option:selected").text(),
                                "version" : $("input[name='version']").val(),
                                "temp_dir": temp_dir
                               })

            // show results
            .done(function(results) {
              $("#data-body").text(results);
              
              //console.log(results)
        
              var myjson = JSON.parse(results);

              var tbl_body = '<thead><tr><th>#mol</th><th>prediction</th></tr></thead>';
              $.each(myjson, function() {
                var tbl_row = "";
                //console.log(this)
                $.each(this, function(k , v) {
                  //console.log(k,v)
                  tbl_body += "<tr><td>"+(k+1)+"</td><td>"+v+"</td></tr>"; 
                })          
              })
              $("#newtable").html(tbl_body);            
          });
          e.preventDefault();
        });
      });
    </script>
  </head>

  <body>
    <div class="container">
      <div class="row">  
          <div class="col-md-6">
            <h2 >Flame predict interface</h2>
          </div>
          
          <div class="col-md-6">
            <img class="pull-right pull-top" src="/static/images/etransafe-logo.png"></image>
          </div>
      </div>  

        <div class="row">
          <div class ="col-md-8">
            <form class="form-horizontal">

              <div class="form-group">
                  <label class="col-sm-2 control-label" for="ifile">Input </label>
                  <div class="col-sm-6">
                    <input type="file" id="ifile" name="ifile">
                  </div>
              </div>
              
              <div class="form-group">
                <label class="col-sm-2 control-label" for="model">model</label>
                <div class="col-sm-8">
                  <select class="form-control" id="myselect" name="model">
                    {% for m in model_list %}
                    <option name="{{ m }}">{{m}}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>
              
              <div class="form-group">
                <label class="col-sm-2 control-label" for="version">version</label>
                <div class="col-sm-8">
                  <input class="form-control" type="number" min=0 value=0 name="version">
                </div>
              </div>
              
            </form>
            
          </div>
          
          <div class="col-md-4 ">
            <button class="btn btn-primary active" role="button" id="predict">Predict</button>
          </div>

      </div>

      <div>

        <h3>Results</h3>
        
        <table class= "table table-bordered table-striped" id="newtable" >
        </table>
        
        <h3>Console</h3>
        
        <pre id="data-body">[not run]</pre>

      </div>
    </div>  
  </body>
</html>